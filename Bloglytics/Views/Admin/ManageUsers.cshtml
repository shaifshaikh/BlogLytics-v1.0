@using Bloglytics.DTO
@model List<AdminUserDto>
@{
    ViewData["Title"] = "Manage Users - Admin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

            .page-header h1 {
                font-size: 32px;
                color: #2d3748;
            }

        .btn-back {
            background: #6c757d;
            color: white;
            padding: 10px 25px;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s;
        }

            .btn-back:hover {
                background: #5a6268;
            }

        .users-table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

            .table thead {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }

            .table th {
                padding: 15px;
                text-align: left;
                font-weight: 600;
            }

            .table td {
                padding: 15px;
                border-bottom: 1px solid #e2e8f0;
            }

            .table tbody tr:hover {
                background: #f8f9fa;
            }

        .role-badge {
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

            .role-badge.admin {
                background: #ef4444;
                color: white;
            }

            .role-badge.blogger {
                background: #10b981;
                color: white;
            }

            .role-badge.editor {
                background: #f59e0b;
                color: white;
            }

        .status-toggle {
            position: relative;
            width: 50px;
            height: 24px;
        }

            .status-toggle input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

            .toggle-slider:before {
                position: absolute;
                content: "";
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }

        input:checked + .toggle-slider {
            background-color: #10b981;
        }

            input:checked + .toggle-slider:before {
                transform: translateX(26px);
            }
    </style>
}

<div class="page-header">
    <h1>👥 Manage Users</h1>
    <a href="@Url.Action("Index")" class="btn-back">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>

<div class="users-table-container">
    <table class="table">
        <thead>
            <tr>
                <th>User</th>
                <th>Email</th>
                <th>Role</th>
                <th>Blogs</th>
                <th>Comments</th>
                <th>Joined</th>
                <th>Last Login</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model)
            {
                <tr>
                    <td style="font-weight: 600;">@user.FullName</td>
                    <td>@user.Email</td>
                    <td>
                        <span class="role-badge @user.Role.ToLower()">@user.Role</span>
                    </td>
                    <td>@user.TotalBlogs</td>
                    <td>@user.TotalComments</td>
                    <td>@user.CreatedAt.ToString("MMM dd, yyyy")</td>
                    <td>@(user.LastLoginAt?.ToString("MMM dd, yyyy") ?? "Never")</td>
                    <td>
                        <label class="status-toggle">
                            <input type="checkbox"
                                   @(user.IsActive ? "checked" : "")
                                   @(user.Role == "Admin" ? "disabled" : "")
                                   onchange="toggleUserStatus(@user.UserId, this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        function toggleUserStatus(userId, isActive) {
            $.ajax({
                url: '@Url.Action("ChangeUserStatus", "Admin")',
                type: 'POST',
                data: {
                    userId: userId,
                    isActive: isActive
                },
                success: function(response) {
                    if (response.success) {
                        alert(isActive ? 'User activated!' : 'User deactivated!');
                    } else {
                        alert('Error: ' + response.message);
                        location.reload();
                    }
                },
                error: function() {
                    alert('Error updating user status');
                    location.reload();
                }
            });
        }
    </script>
}